<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Turnos Predicación</title>
    <style>
        :root {
            --bg-dark: #121212;
            --bg-body: #1e1e1e;
            --bg-card-blue: #2c2c3e;
            --primary-orange: #f36100;
            --text-white: #ffffff;
            --text-gray: #a0a0a0;
            --radius: 24px;
        }

        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: var(--bg-body); color: var(--text-white); display: flex; justify-content: center; }

        .app-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            width: 100%;
            max-width: 1100px;
            padding: 20px;
        }

        .screen { background-color: var(--bg-dark); border-radius: var(--radius); overflow: hidden; height: 850px; display: flex; flex-direction: column; }

        /* LADO IZQUIERDO: LOCACIONES */
        .scroll-container { padding: 20px; overflow-y: auto; flex-grow: 1; }
        .location-card {
            padding: 20px; border-radius: var(--radius); margin-bottom: 15px;
            cursor: pointer; transition: 0.3s; border: 2px solid transparent;
            background-color: #222; position: relative; min-height: 100px; display: flex; align-items: flex-end;
        }
        .location-card.active { border-color: var(--primary-orange); background-color: #333; }
        .card-label h2 { margin: 0; font-size: 1.1rem; position: relative; z-index: 2; }

        /* LADO DERECHO: DETALLES */
        .hero-img { height: 160px; background-color: #333; background-image: url('https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?q=80&w=600'); background-size: cover; background-position: center; }
        .days-row { display: flex; justify-content: space-between; margin: 20px 0; }
        .day-btn { color: var(--text-gray); cursor: pointer; padding: 10px; font-weight: bold; }
        .day-btn.active { background: white; color: var(--primary-orange); border-radius: 50%; width: 38px; height: 38px; display: grid; place-items: center; }

        /* TURNOS Y COLORES */
        .slot { padding: 20px; border-radius: var(--radius); margin-bottom: 12px; }
        .turno-M { background-color: var(--primary-orange) !important; }
        .turno-T { background-color: var(--bg-card-blue) !important; }
        .slot h4 { margin: 0 0 10px 0; font-size: 1.05rem; color: white; }
        .badge { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; color: white; }

        @media (min-width: 768px) { .app-wrapper { grid-template-columns: 350px 1fr; } }
        .p-20 { padding: 20px; }
    </style>
</head>
<body>

    <div class="app-wrapper">
        <section class="screen">
            <div class="p-20"><h1 style="margin:0">Locaciones</h1></div>
            <div class="scroll-container">
                <div class="location-card active" onclick="selectPoint('Clínica Cordillera', this)">
                    <div class="card-label"><h2>Clínica Cordillera</h2></div>
                </div>
                <div class="location-card" onclick="selectPoint('Supermercado Lider', this)">
                    <div class="card-label"><h2>Supermercado Lider</h2></div>
                </div>
                <div class="location-card" onclick="selectPoint('Santa Zita', this)">
                    <div class="card-label"><h2>Santa Zita</h2></div>
                </div>
                <div class="location-card" onclick="selectPoint('Visviri/Supermercado Santa Isabel', this)">
                    <div class="card-label"><h2>Visviri / Santa Isabel</h2></div>
                </div>
                <div class="location-card" onclick="selectPoint('Feria de Francisco Bilbao (Curaco)', this)">
                    <div class="card-label"><h2>Feria Bilbao (Curaco)</h2></div>
                </div>
                <div class="location-card" onclick="selectPoint('Parque Intercomunal La Reina (Duqueco)', this)">
                    <div class="card-label"><h2>Parque Intercomunal</h2></div>
                </div>
                <div class="location-card" onclick="selectPoint('Patricia', this)">
                    <div class="card-label"><h2>Patricia</h2></div>
                </div>
            </div>
        </section>

        <section class="screen">
            <div class="hero-img"></div>
            <div class="p-20">
                <h2 id="currentPointTitle" style="margin:0">Clínica Cordillera</h2>
                <div class="days-row">
                    <div class="day-btn active" onclick="setDay('Lunes', this)">Lun</div>
                    <div class="day-btn" onclick="setDay('Martes', this)">Mar</div>
                    <div class="day-btn" onclick="setDay('Miercoles', this)">Mie</div>
                    <div class="day-btn" onclick="setDay('Jueves', this)">Jue</div>
                    <div class="day-btn" onclick="setDay('Viernes', this)">Vie</div>
                </div>
                <div id="slotsContainer">Cargando turnos desde la nube...</div>
            </div>
        </section>
    </div>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSSVTME1tFKORVdcn5noIwMpgV6v7Ehm1RbodRcEOJfnjdbIEIRT87nYVxc6ySprl3RrZCUzsiYpH64/pub?output=csv'; 
        
        let allData = [];
        let currentDay = 'Lunes';
        let currentPoint = 'Clínica Cordillera';

        async function loadData() {
            try {
                const response = await fetch(SHEET_URL);
                const text = await response.text();
                // Limpieza de filas para evitar errores de lectura
                const rows = text.split(/\r?\n/).filter(row => row.trim() !== "").slice(1);
                
                allData = rows.map(row => {
                    // Regex avanzada para separar por comas ignorando comas dentro de comillas
                    const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return {
                        dia: cols[0] ? cols[0].trim() : "",
                        tipo: cols[1] ? cols[1].trim().toUpperCase() : "",
                        participantes: cols[2] ? cols[2].trim().replace(/"/g, "") : "",
                        horario: cols[3] ? cols[3].trim().replace(/"/g, "") : "",
                        punto: cols[4] ? cols[4].trim().replace(/"/g, "") : ""
                    };
                });
                renderSlots();
            } catch (e) {
                document.getElementById('slotsContainer').innerHTML = "Error al conectar con la base de datos.";
            }
        }

        function selectPoint(name, el) {
            currentPoint = name;
            document.getElementById('currentPointTitle').innerText = name;
            document.querySelectorAll('.location-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            renderSlots();
        }

        function setDay(day, el) {
            currentDay = day;
            document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            renderSlots();
        }

        function renderSlots() {
            const container = document.getElementById('slotsContainer');
            container.innerHTML = '';

            const filtered = allData.filter(d => 
                d.dia.toLowerCase() === currentDay.toLowerCase() && 
                d.punto === currentPoint
            );

            if(filtered.length === 0) {
                container.innerHTML = `<p style="text-align:center; color:gray; margin-top:40px;">No hay turnos registrados en <b>${currentPoint}</b> para el día <b>${currentDay}</b>.</p>`;
                return;
            }

            filtered.forEach(t => {
                const div = document.createElement('div');
                // Lógica de color blindada
                const isTarde = t.tipo.includes('T');
                div.className = `slot ${isTarde ? 'turno-T' : 'turno-M'}`;
                
                div.innerHTML = `
                    <h4>${t.participantes}</h4>
                    <span class="badge">${t.horario}</span>
                `;
                container.appendChild(div);
            });
        }

        // Carga inicial
        loadData();
    </script>
</body>
</html>
