<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Turnos Predicación</title>

  <style>
    :root {
      --bg-dark: #121212;
      --bg-body: #1e1e1e;
      --bg-card-blue: #2c2c3e;
      --green: #04c92f;
      --primary-orange: #f36100;
      --text-white: #ffffff;
      --text-gray: #a0a0a0;
      --radius: 24px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg-body);
      color: var(--text-white);
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .app-wrapper {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      width: 100%;
      max-width: 1100px;
      padding: 20px;
    }

    .screen {
      background-color: var(--bg-dark);
      border-radius: var(--radius);
      overflow: hidden;
      height: 850px;
      display: flex;
      flex-direction: column;
    }

    /* --- LOCACIONES (LISTA PRINCIPAL) --- */
    .scroll-container { padding: 20px; overflow-y: auto; flex-grow: 1; }

    .location-card {
      padding: 20px;
      border-radius: var(--radius);
      margin-bottom: 15px;
      cursor: pointer;
      transition: 0.3s;
      border: 2px solid transparent;

      /* Se mantiene tu base, pero ahora soporta imagen */
      background-color: #222;
      background-size: cover;
      background-position: center;

      position: relative;
      min-height: 100px;
      display: flex;
      align-items: flex-end;
      overflow: hidden; /* para que el overlay respete el radio */
    }

    /* Overlay para legibilidad del texto (no cambia layout) */
    .location-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to top,
        rgba(0,0,0,0.75),
        rgba(0,0,0,0.15)
      );
      pointer-events: none;
    }

    .location-card.active { border-color: var(--primary-orange); }

    .card-label {
      position: relative;
      z-index: 1;
    }

    .card-label h2 { margin: 0; font-size: 1.1rem; }

    /* --- DETALLES (VISTA SECUNDARIA) --- */
    .hero-img {
      height: 160px;
      background-color: #333;
      background-size: cover;
      background-position: center;
      position: relative;
      overflow: hidden;
    }

    /* Overlay para que el botón y título se lean bien (no mueve nada) */
    .hero-img::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to top,
        rgba(0,0,0,0.65),
        rgba(0,0,0,0.10)
      );
      pointer-events: none;
    }

    .back-btn {
      position: absolute; top: 15px; left: 15px;
      background: rgba(0,0,0,0.6); border: none; color: white;
      padding: 8px 15px; border-radius: 20px; cursor: pointer;
      display: none; /* Se muestra solo en móvil */
      font-weight: bold; align-items: center; gap: 5px;
      z-index: 2;
    }

    .days-row {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }

    .day-btn {
      flex: 1;
      text-align: center;
      color: var(--text-gray);
      cursor: pointer;
      font-weight: 700;

      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;

      border-radius: 999px;
      padding: 0 10px;
      line-height: 1;
    }

    .day-btn.active {
      background: #fff;
      color: var(--primary-orange);
      border-radius: 999px;
    }

    /* TURNOS */
    .slot { padding: 20px; border-radius: var(--radius); margin-bottom: 12px; }
    .turno-M  { background-color: var(--primary-orange) !important; }
    .turno-T  { background-color: var(--bg-card-blue) !important; }
    .turno-TD { background-color: var(--green) !important; }

    .slot h4 { margin: 0 0 10px 0; font-size: 1.05rem; color: white; }
    .badge { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; color: white; }

    /* --- LÓGICA RESPONSIVE --- */
    @media (min-width: 768px) {
      .app-wrapper { grid-template-columns: 350px 1fr; }
      #detail-screen { display: flex !important; } /* Siempre visible en PC */
      .back-btn { display: none !important; }
    }

    @media (max-width: 767px) {
      .app-wrapper { padding: 0; }
      .screen { height: 100vh; border-radius: 0; }
      #detail-screen { display: none; } /* Oculto por defecto en móvil */
      .back-btn { display: flex; }
    }

    .p-20 { padding: 20px; }
  </style>
</head>

<body>
  <div class="app-wrapper">

    <section class="screen" id="list-screen">
      <div class="p-20"><h1 style="margin:0">Locaciones</h1></div>

      <div class="scroll-container">
        <div class="location-card active" onclick="selectPoint('Clínica Cordillera', this)">
          <div class="card-label"><h2>Clínica Cordillera</h2></div>
        </div>

        <div class="location-card" onclick="selectPoint('Supermercado Lider', this)">
          <div class="card-label"><h2>Supermercado Lider</h2></div>
        </div>

        <div class="location-card" onclick="selectPoint('Santa Zita', this)">
          <div class="card-label"><h2>Santa Zita</h2></div>
        </div>

        <div class="location-card" onclick="selectPoint('Visviri / Santa Isabel', this)">
          <div class="card-label"><h2>Visviri / Santa Isabel</h2></div>
        </div>

        <div class="location-card" onclick="selectPoint('Feria de Francisco Bilbao (Curaco)', this)">
          <div class="card-label"><h2>Feria de Francisco Bilbao (Curaco)</h2></div>
        </div>

        <div class="location-card" onclick="selectPoint('Parque Intercomunal', this)">
          <div class="card-label"><h2>Parque Intercomunal</h2></div>
        </div>

        <div class="location-card" onclick="selectPoint('Patricia', this)">
          <div class="card-label"><h2>Patricia</h2></div>
        </div>
      </div>
    </section>

    <section class="screen" id="detail-screen">
      <div class="hero-img">
        <button class="back-btn" onclick="goBack()">← Volver</button>
      </div>

      <div class="p-20">
        <h2 id="currentPointTitle" style="margin:0">Clínica Cordillera</h2>

        <div class="days-row">
          <div class="day-btn active" onclick="setDay('Lunes', this)">Lun</div>
          <div class="day-btn" onclick="setDay('Martes', this)">Mar</div>
          <div class="day-btn" onclick="setDay('Miercoles', this)">Mie</div>
          <div class="day-btn" onclick="setDay('Jueves', this)">Jue</div>
          <div class="day-btn" onclick="setDay('Viernes', this)">Vie</div>
          <div class="day-btn" onclick="setDay('Sabado', this)">Sab</div>
          <div class="day-btn" onclick="setDay('Domingo', this)">Dom</div>
        </div>

        <div id="slotsContainer">Cargando...</div>
      </div>
    </section>

  </div>

  <script>
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSSVTME1tFKORVdcn5noIwMpgV6v7Ehm1RbodRcEOJfnjdbIEIRT87nYVxc6ySprl3RrZCUzsiYpH64/pub?output=csv';

    let allData = [];
    let currentDay = 'Lunes';
    let currentPoint = 'Clínica Cordillera';

    // ✅ IMÁGENES POR PUNTO (cambia las URLs por las tuyas cuando quieras)
    const POINT_IMAGES = {
      "Clínica Cordillera": "https://images.unsplash.com/photo-1586773860418-d37222d8fce3?auto=format&fit=crop&w=1200&q=60",
      "Supermercado Lider": "https://images.unsplash.com/photo-1601598851547-4302969d0614?auto=format&fit=crop&w=1200&q=60",
      "Santa Zita": "https://images.unsplash.com/photo-1520628186254-01d3b1a13a74?auto=format&fit=crop&w=1200&q=60",
      "Visviri / Santa Isabel": "https://images.unsplash.com/photo-1542831371-29b0f74f9713?auto=format&fit=crop&w=1200&q=60",
      "Feria de Francisco Bilbao (Curaco)": "https://images.unsplash.com/photo-1506806732259-39c2d0268443?auto=format&fit=crop&w=1200&q=60",
      "Parque Intercomunal": "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1200&q=60",
      "Patricia": "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=1200&q=60"
    };

    function applyImagesToCards() {
      document.querySelectorAll('.location-card').forEach(card => {
        const titleEl = card.querySelector('h2');
        const name = titleEl ? titleEl.innerText.trim() : "";
        const img = POINT_IMAGES[name];

        if (img) {
          card.style.backgroundImage = `url('${img}')`;
        } else {
          card.style.backgroundImage = 'none';
          card.style.backgroundColor = '#222';
        }
      });
    }

    function setHeroImage(pointName) {
      const hero = document.querySelector('.hero-img');
      const img = POINT_IMAGES[pointName];

      if (img) hero.style.backgroundImage = `url('${img}')`;
      else hero.style.backgroundImage = 'none';
    }

function norm(str) {
  return (str ?? "")
    .toString()
    .trim()
    .replace(/\u00A0/g, " ")        // espacios raros
    .replace(/\s+/g, " ")           // colapsa espacios
    .replace(/\s*\/\s*/g, "/")      // " / " -> "/"
    .toLowerCase();
}

    
    async function loadData() {
      try {
        const response = await fetch(SHEET_URL);
        const text = await response.text();
        const rows = text.split(/\r?\n/).filter(row => row.trim() !== "").slice(1);

        allData = rows.map(row => {
          const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
          return {
            dia: cols[0] ? cols[0].trim() : "",
            tipo: cols[1] ? cols[1].trim().replace(/"/g, "").toUpperCase() : "",
            participantes: cols[2] ? cols[2].trim().replace(/"/g, "") : "",
            horario: cols[3] ? cols[3].trim().replace(/"/g, "") : "",
            punto: cols[4] ? cols[4].trim().replace(/"/g, "") : ""
          };
        });

        renderSlots();
      } catch (e) {
        document.getElementById('slotsContainer').innerHTML = "Error de conexión.";
      }
    }

    function selectPoint(name, el) {
      currentPoint = name;
      document.getElementById('currentPointTitle').innerText = name;

      // ✅ actualiza imagen del header
      setHeroImage(name);

      document.querySelectorAll('.location-card').forEach(c => c.classList.remove('active'));
      el.classList.add('active');

      renderSlots();

      // En móvil, cambiar de pantalla
      if (window.innerWidth < 768) {
        document.getElementById('list-screen').style.display = 'none';
        document.getElementById('detail-screen').style.display = 'flex';
        window.scrollTo(0, 0);
      }
    }

    function goBack() {
      document.getElementById('list-screen').style.display = 'flex';
      document.getElementById('detail-screen').style.display = 'none';
    }

    function setDay(day, el) {
      currentDay = day;
      document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
      el.classList.add('active');
      renderSlots();
    }

    function renderSlots() {
      const container = document.getElementById('slotsContainer');
      container.innerHTML = '';

      const filtered = allData.filter(d =>
        d.dia.toLowerCase() === currentDay.toLowerCase() &&
        d.punto === currentPoint
      );

      if (filtered.length === 0) {
        container.innerHTML = `<p style="text-align:center; color:gray; margin-top:40px;">No hay turnos para este día.</p>`;
        return;
      }

      filtered.forEach(t => {
        const div = document.createElement('div');

        const tipoRaw = (t.tipo ?? '').toString();
        const tipo = tipoRaw
          .replace(/\u00A0/g, ' ')
          .replace(/\s+/g, '')
          .replace(/"/g, '')
          .toUpperCase();

        const tipoNorm = tipo.replace('/', '');

        let clase = 'turno-M';
        if (tipoNorm.includes('TD')) clase = 'turno-TD';
        else if (tipoNorm.startsWith('T')) clase = 'turno-T';
        else if (tipoNorm.startsWith('M')) clase = 'turno-M';

        div.className = `slot ${clase}`;
        div.innerHTML = `<h4>${t.participantes}</h4><span class="badge">${t.horario}</span>`;
        container.appendChild(div);
      });
    }

    // ✅ Inicialización
    applyImagesToCards();        // pone imagen a las tarjetas del listado
    setHeroImage(currentPoint);  // pone imagen arriba según el punto inicial
    loadData();
  </script>
</body>
</html>
